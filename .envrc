# Fix nix CXXABI compatibility early
# This resolves CXXABI_1.3.15 errors when direnv loads nix
if [ -d "/nix/store" ]; then
  # Find the nix lib directory and add it to LD_LIBRARY_PATH
  NIX_LIB=$(ls -d /nix/store/*-nix-*/lib 2>/dev/null | head -1)
  if [ -d "$NIX_LIB" ]; then
    export LD_LIBRARY_PATH="$NIX_LIB:${LD_LIBRARY_PATH}"
  fi
fi

# Ensure nix is available in PATH for direnv
# Try both standard paths for nix installation
export PATH="/nix/var/nix/profiles/default/bin:${PATH}"
export PATH="$HOME/.nix-profile/bin:${PATH}"

# Suppress git warnings about dirty tree during flake evaluation
# This speeds up direnv loading in VSCode terminal
export NIX_IGNORE_SYMLINK_STORE=1

# Use the flake - this will load the Flutter + Android development environment
# Note: First load may take 10-30 seconds as it initializes the environment
# Subsequent loads should be much faster as the environment is cached
use flake
